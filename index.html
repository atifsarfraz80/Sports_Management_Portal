<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <title>Tournament Portal ‚Äî Sports Management</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- GLOBAL LOADER -->
  <div id="globalLoader" class="loader-overlay hidden">
    <div class="loader-spinner"></div>
  </div>

  <header class="topbar">
    <div class="brand">
      <div class="logo-square">TP</div>
      <div class="brand-text">
        <div class="brand-title">Tournament Portal</div>
        <div class="brand-sub">Manage sports & events</div>
      </div>
    </div>
    <button class="menu-toggle" id="menuToggle" onclick="toggleMobileMenu()">
    <span></span>
    <span></span>
    <span></span>
  </button>

    <nav class="topnav" id="mainNav">
      <a class="navlink" onclick="showPage('home')" data-page="home">Home</a>
      <a class="navlink" onclick="showPage('events')" data-page="events">Events</a>
      <a class="navlink" onclick="showPage('sports')" data-page="sports">Sports</a>
      <a class="navlink" onclick="showPage('teams')" data-page="teams">Teams</a>
      <a class="navlink" onclick="showPage('matches')" data-page="matches">Matches</a>
      <a class="navlink" onclick="showPage('venues')" data-page="venues">Venues</a>
      <a class="navlink" onclick="showPage('leaderboard')" data-page="leaderboard">Leaderboard</a>

      <a class="navlink auth" id="navAuth" onclick="showPage('auth')" data-page="auth">Login</a>

      <a class="navlink role hidden" id="navManager" onclick="showPage('managerDashboard')" data-page="managerDashboard">Dashboard</a>
      <a class="navlink role hidden" id="navAdmin" onclick="showPage('adminDashboard')" data-page="adminDashboard">Dashboard</a>
      <a class="navlink role hidden" id="navLogout" onclick="logoutUser()">Logout</a>
    </nav>
  </header>

  <main id="app">

    <!-- HOME PAGE -->
    <section id="home" class="page">
      <div class="hero container">
        <div class="hero-left">
          <h1>Welcome to the Sports Tournament Portal</h1>
          <p class="lead">Track events, teams, and real-time results for all ongoing and scheduled competitions. Your data-driven sports management solution.</p>
          <div id="activeEventBanner" class="event-banner hidden">
            üèÜ <strong>Current Event:</strong> <span id="activeEventName"></span>
          </div>
          <div id="registrationBanner" class="registration-banner hidden">
          <div id="registrationStatus"></div>
          </div>
          <div class="hero-ctas" id="heroCTAs">
            <button onclick="showPage('leaderboard')" class="btn primary">View Leaderboards</button>
            <button id="heroCTA2" class="btn ghost">Register a Team</button>
          </div>
        </div>
        <div class="hero-right">
          <div class="stats-grid">
            <div class="stat card">
              <div class="stat-num" id="stat-events">0</div>
              <div class="stat-label">Total Events</div>
            </div>
            <div class="stat card">
              <div class="stat-num" id="stat-sports">0</div>
              <div class="stat-label">Available Sports</div>
            </div>
            <div class="stat card">
              <div class="stat-num" id="stat-teams">0</div>
              <div class="stat-label">Approved Teams</div>
            </div>
            <div class="stat card">
              <div class="stat-num" id="stat-matches">0</div>
              <div class="stat-label">Matches Scheduled</div>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="recap-grid">
          <div class="card recap-card">
            <div class="section-header">
              <h3>Upcoming Matches</h3>
              <button class="btn ghost" onclick="showPage('matches')">Full Calendar</button>
            </div>
            <div id="homeMatchesRecap">
              <p class="muted">Loading match info...</p>
            </div>
          </div>

          <div class="card recap-card">
            <div class="section-header">
              <h3>Leaderboard</h3>
              <button class="btn primary" onclick="showPage('leaderboard')">View All</button>
            </div>
            <div id="homePointsRecap">
              <p class="muted">No leaderboard data available.</p>
            </div>
          </div>

          <div class="card recap-card">
            <div class="section-header">
              <h3>Recent Events</h3>
              <button id="homeEventsBtn" class="btn ghost" onclick="showPage('events')">View Events</button>
            </div>
            <div id="homeEventsRecap">
              <p class="muted">No recent events to display.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- COMBINED AUTH PAGE (LOGIN/SIGNUP) -->
    <section id="auth" class="page hidden container-narrow">
      <div class="card form-card">
        <div class="auth-toggle">
          <button id="tabLogin" class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
          <button id="tabSignup" class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
        </div>

        <!-- LOGIN FORM -->
        <div id="loginForm" class="auth-form">
          <h2>Welcome Back</h2>
          <label>Email</label>
          <input id="loginEmail" type="email" placeholder="you@example.com" required />
          <label>Password</label>
          <input id="loginPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          <p class="error hidden" id="loginError"></p>
          <div class="form-actions">
            <button class="btn primary full-width" onclick="loginUser()">Login</button>
          </div>
          <p class="auth-switch">
            Don't have an account? <a onclick="switchAuthTab('signup')">Sign up now</a>
          </p>
          <p class="auth-switch">
            <a href="reset-password.html">Forgot Password?</a>
          </p>
        </div>

        <!-- SIGNUP FORM -->
        <div id="signupForm" class="auth-form hidden">
          <h2>Create Account</h2>
          <label>Username</label>
          <input id="signupUsername" type="text" placeholder="john_doe" required minlength="3" />
          <label>Email</label>
          <input id="signupEmail" type="email" placeholder="you@example.com" required />
          <p class="muted small">‚ö†Ô∏è Please use a valid email - you'll receive important notifications</p>
          <label>Password</label>
          <input id="signupPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" />
          <p class="muted small">Minimum 6 characters</p>
          <p class="muted">Signing up creates a manager account.</p>
          <p class="error hidden" id="signupError"></p>
          <div class="form-actions">
            <button class="btn primary full-width" onclick="signupUser()">Create Account</button>
          </div>
          <p class="auth-switch">
            Already have an account? <a onclick="switchAuthTab('login')">Login here</a>
          </p>
        </div>
      </div>
    </section>

    <!-- EVENTS PAGE -->
    <section id="events" class="page hidden container">
      <div class="card">
        <div class="card-header">
          <h2>Events</h2>
          <div id="eventsActions"></div>
        </div>
        <div id="eventsList" class="list-area"></div>
      </div>
    </section>

    <!-- SPORTS PAGE -->
    <section id="sports" class="page hidden container">
      <div class="card">
        <div class="card-header">
          <h2>Sports</h2>
          <div id="sportsActions"></div>
        </div>
        <div id="sportsList" class="list-area"></div>
      </div>
    </section>

    <!-- TEAMS PAGE  -->
    <section id="teams" class="page hidden container">
      <div class="card">
        <div class="card-header">
          <h2>Approved Teams</h2>
          <div id="teamsActions"></div>
        </div>
        <div style="margin-bottom: 16px;">
          <input type="text" id="teamSearchInput" placeholder="Search teams by name..." 
                 style="max-width: 400px;" 
                 oninput="searchTeams(this.value)" />
        </div>
        <div id="teamsList" class="list-area"></div>
      </div>
    </section>

  <!-- MATCHES PAGE  -->
<section id="matches" class="page hidden container">
  <div class="card">
    <div class="card-header">
      <h2>Matches</h2>
      <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
        <select id="matchViewFilter" class="hidden" onchange="renderMatches()">
          <option value="all">All Matches</option>
          <option value="my">My Team's Matches</option>
        </select>
        <select id="matchSportFilter" onchange="filterMatches()">
          <option value="">All Sports</option>
        </select>
        <input type="date" id="matchDateFrom" placeholder="From" onchange="filterMatches()" />
        <input type="date" id="matchDateTo" placeholder="To" onchange="filterMatches()" />
        <button class="btn ghost" onclick="clearMatchFilters()">Clear Filters</button>
        <div id="matchesActions"></div>
      </div>
    </div>
    <div id="matchesList" class="list-area"></div>
  </div>
</section>

    <!-- LEADERBOARD PAGE-->
<section id="leaderboard" class="page hidden container">
  <div class="card">
    <div class="card-header">
      <h2>Leaderboard</h2>
      <div style="display: flex; gap: 12px; flex-wrap: wrap;">
        <select id="leaderboardEvent" onchange="updateLeaderboardSports()" required>
          <option value="">Select Event</option>
        </select>
        <select id="leaderboardSport" onchange="renderPoints()" required disabled>
          <option value="">Select Event First</option>
        </select>
      </div>
    </div>
    <div id="pointsList" class="list-area"></div>
  </div>
</section>

<!-- VENUES PAGE -->
<section id="venues" class="page hidden container">
  <div class="card">
    <div class="card-header">
      <h2>Venues</h2>
      <div id="venuesActions"></div>
    </div>
    <div id="venuesList" class="list-area"></div>
  </div>
</section>

    <!-- MANAGER DASHBOARD -->
    <section id="managerDashboard" class="page hidden container">
      <div class="card">
        <div id="managerUserInfo" class="hidden"></div>
        <div class="card-header">
          <h2>Manager Dashboard</h2>
        </div>
        <div class="grid-3">
          <div class="small-card">
            <h4>My Teams</h4>
            <p class="stat-large" id="mgrTeamCount">‚Äî</p>
            <button class="btn" onclick="showPage('teams')">View All Teams</button>
          </div>
          <div class="small-card">
            <h4>My Matches</h4>
            <p class="stat-large" id="mgrMatchCount">‚Äî</p>
            <button class="btn" onclick="showPage('matches'); $('#matchViewFilter').value='my'; renderMatches();">View Matches</button>
          </div>
          <div class="small-card">
            <h4>Register Team</h4>
            <p>For active event</p>
            <button class="btn primary" onclick="openRegisterTeamModal()">Register Now</button>
          </div>
        </div>

        <div id="managerTeamsList" style="margin-top: 24px;">
          <h3>Your Teams</h3>
          <div id="mgrTeamsContainer"></div>
        </div>
      </div>
    </section>

    <!-- ADMIN DASHBOARD -->
    <section id="adminDashboard" class="page hidden container">
      <div class="card">
        <div id="adminUserInfo" class="hidden"></div>
        <div class="card-header">
          <h2>Admin Dashboard</h2>
        </div>
        <div class="grid-4">
          <div class="small-card">
            <h4>Events</h4>
            <p class="stat-large" id="adminEvents">‚Äî</p>
            <button class="btn" onclick="showPage('events')">Manage</button>
          </div>
          <div class="small-card">
            <h4>Sports</h4>
            <p class="stat-large" id="adminSports">‚Äî</p>
            <button class="btn" onclick="showPage('sports')">Manage</button>
          </div>
          <div class="small-card">
            <h4>Pending Teams</h4>
            <p class="stat-large" id="adminPendingTeams">‚Äî</p>
            <button class="btn primary" onclick="showPendingTeamsModal()">Review</button>
          </div>
          <div class="small-card">
            <h4>Matches</h4>
            <p class="stat-large" id="adminMatches">‚Äî</p>
            <button class="btn" onclick="showPage('matches')">Manage</button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- MODAL OVERLAY -->
  <div id="modalOverlay" class="modal-overlay hidden" onclick="closeAllModals()"></div>

  <!-- REGISTER TEAM MODAL -->
  <div id="modal-register-team" class="modal hidden">
    <div class="modal-inner card large-modal">
      <div class="modal-head">
        <h3>Register Team</h3>
        <button class="close" onclick="closeModal('modal-register-team')">&times;</button>
      </div>
      
      <div class="modal-body">
        <label>Team Name <span class="required">*</span></label>
        <input id="regTeamName" type="text" placeholder="Enter team name" minlength="3" maxlength="50" required />
        <p class="muted small">3-50 characters</p>
        
        <label>Select Sport <span class="required">*</span></label>
        <select id="regTeamSport" onchange="updatePlayerFields()" required>
          <option value="">Select Sport</option>
        </select>
        
        <label>Upload Logo (optional)</label>
        <input id="regTeamLogo" type="file" accept="image/jpeg,image/jpg,image/png,image/gif" />
        <p class="muted small">Max 5MB, formats: JPG, PNG, GIF</p>
        
        <div id="playersSection" class="hidden" style="margin-top: 24px;">
          <h4>Main Players <span id="reqPlayersLabel"></span></h4>
          <div id="mainPlayersContainer"></div>
          
          <h4 style="margin-top: 20px;">Substitutes <span id="subsLabel">(Optional)</span></h4>
          <div id="subsPlayersContainer"></div>
          <button type="button" class="btn ghost" id="addSubBtn" onclick="addSubstituteField()">+ Add Substitute</button>
        </div>
      </div>

      <div id="paymentSection" class="hidden" style="margin-top: 24px; padding: 16px; background: #fef3c7; border-radius: 8px; border: 2px solid #fbbf24;">
  <h4 style="margin: 0 0 12px 0; color: #92400e;">üí≥ Payment Required</h4>
  <p style="margin: 0 0 12px 0; font-weight: 600; font-size: 18px; color: #92400e;">
    Registration Fee: Rs.<span id="regFeeAmount">Rs.0</span>
  </p>
  <label>Upload Payment Screenshot <span class="required">*</span></label>
  <input id="regPaymentScreenshot" type="file" accept="image/jpeg,image/jpg,image/png,image/gif" />
  <p class="muted small">Please upload proof of payment (screenshot/receipt). Required for approval.</p>
</div>
      
      <div class="form-actions">
        <button class="btn primary" onclick="submitTeamRegistration()">Submit Registration</button>
        <button class="btn ghost" onclick="closeModal('modal-register-team')">Cancel</button>
      </div>
    </div>
  </div>

 <!-- ADD VENUE MODAL -->
<div id="modal-add-venue" class="modal hidden">
  <div class="modal-inner card">
    <div class="modal-head">
      <h3>Add Venue</h3>
      <button class="close" onclick="closeModal('modal-add-venue')">&times;</button>
    </div>
    <label>Venue Name <span class="required">*</span></label>
    <input id="venueName" placeholder="e.g. Main Ground" required />
    
    <label>Sport <span class="required">*</span></label>
    <select id="venueSport" required>
      <option value="">Select Sport</option>
    </select>
    <p class="muted small">This venue will only appear for this sport when scheduling matches</p>
    
    <label>Location</label>
    <input id="venueLocation" placeholder="City or area" />
    
    <label>Capacity</label>
    <input id="venueCapacity" type="number" min="0" placeholder="e.g. 5000" />
    
    <div class="form-actions">
      <button class="btn primary" onclick="createVenue()">Create Venue</button>
      <button class="btn ghost" onclick="closeModal('modal-add-venue')">Cancel</button>
    </div>
  </div>
</div>



  <!-- PENDING TEAMS MODAL (Admin) -->
  <div id="modal-pending-teams" class="modal hidden">
    <div class="modal-inner card large-modal">
      <div class="modal-head">
        <h3>Pending Team Approvals</h3>
        <button class="close" onclick="closeModal('modal-pending-teams')">&times;</button>
      </div>
      <div id="pendingTeamsList" class="modal-body"></div>
    </div>
  </div>

  <!-- SCHEDULE MATCH MODAL (Admin) -->
<div id="modal-schedule-match" class="modal hidden">
  <div class="modal-inner card">
    <div class="modal-head">
      <h3>Schedule Match</h3>
      <button class="close" onclick="closeModal('modal-schedule-match')">&times;</button>
    </div>
    <label>Event <span class="required">*</span></label>
    <select id="matchEvent" onchange="loadTeamsForSport()" required>
      <option value="">Select Event</option>
    </select>
    <label>Sport <span class="required">*</span></label>
    <select id="matchSport" onchange="loadTeamsForSport()" required>
      <option value="">Select Event First</option>
    </select>
    <label>Team A <span class="required">*</span></label>
    <select id="matchTeam1" required>
      <option value="">Select Sport First</option>
    </select>
    <label>Team B <span class="required">*</span></label>
    <select id="matchTeam2" required>
      <option value="">Select Sport First</option>
    </select>
    <label>Venue (Optional)</label>
    <select id="matchVenue">
      <option value="">Select Venue</option>
    </select>
    <label>Date & Time <span class="required">*</span></label>
    <input id="matchDatetime" type="datetime-local" required />
    <p class="muted small">Match time must be between 8:00 AM and 10:00 PM</p>
    <div class="form-actions">
      <button class="btn primary" onclick="scheduleMatch()">Schedule</button>
      <button class="btn ghost" onclick="closeModal('modal-schedule-match')">Cancel</button>
    </div>
  </div>
</div>

  <!-- ADD EVENT MODAL (Admin) -->
  <div id="modal-add-event" class="modal hidden">
    <div class="modal-inner card">
      <div class="modal-head">
        <h3>Add Event</h3>
        <button class="close" onclick="closeModal('modal-add-event')">&times;</button>
      </div>
      <label>Event Name <span class="required">*</span></label>
      <input id="evName" placeholder="e.g., Spring Tournament 2025" required />
      <label>Start Date <span class="required">*</span></label>
      <input id="evStart" type="date" required />
      <label>End Date <span class="required">*</span></label>
      <input id="evEnd" type="date" required />
      <label>Location</label>
      <input id="evLocation" placeholder="e.g., Central Stadium" />
      <label>Description</label>
      <textarea id="evDescription" placeholder="Event details..."></textarea>
      <label>Registration Start Date <span class="required">*</span></label>
          <input id="evRegStart" type="date" required />
          <p class="muted small">When teams can start registering</p>
          <label>Registration End Date <span class="required">*</span></label>
          <input id="evRegEnd" type="date" required />
          <p class="muted small">Must be before event starts</p>
      <div class="form-actions">
        <button class="btn primary" onclick="createNewEvent()">Create Event</button>
        <button class="btn ghost" onclick="closeModal('modal-add-event')">Cancel</button>
      </div>
    </div>
  </div>

 <!-- ADD SPORT MODAL (Admin) -->
<div id="modal-add-sport" class="modal hidden">
  <div class="modal-inner card">
    <div class="modal-head">
      <h3>Add Sport</h3>
      <button class="close" onclick="closeModal('modal-add-sport')">&times;</button>
    </div>
    <label>Sport Name <span class="required">*</span></label>
    <input id="sportName" placeholder="e.g., Football (11v11)" required />
    <label>Team Size (main players) <span class="required">*</span></label>
    <input id="sportTeamSize" type="number" min="1" max="50" value="11" required />
    <label>Max Substitutes</label>
    <input id="sportMaxSubs" type="number" min="0" max="20" value="7" />
    <label>Registration Fee (Rs.) <span class="required">*</span></label>
    <input id="sportFee" type="number" min="0" max="5000" value="0" required />
    <p class="muted small">Set to 0 for free registration. Fee must be between Rs.200-Rs.5000 if charged.</p>
    <div class="form-actions">
      <button class="btn primary" onclick="createSport()">Create Sport</button>
      <button class="btn ghost" onclick="closeModal('modal-add-sport')">Cancel</button>
    </div>
  </div>
</div>


  <!-- MANAGE EVENT SPORTS MODAL (Admin) -->
<div id="modal-manage-sports" class="modal hidden">
  <div class="modal-inner card large-modal">
    <div class="modal-head">
      <h3>Manage Event Sports</h3>
      <button class="close" onclick="closeModal('modal-manage-sports')">&times;</button>
    </div>
    <div class="modal-body">
      <p class="muted" style="margin-bottom: 16px;">Add or remove sports from this event</p>
      
      <h4>Sports in Event</h4>
      <div id="eventSportsList" style="margin-bottom: 24px;"></div>
      
      <h4>Available Sports (Not in Event)</h4>
      <div id="availableSportsList"></div>
    </div>
  </div>
</div>

  <script src="app.js"></script>
  
  <script>
    // Team search
    let searchTimeout;
    function searchTeams(query) {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const filtered = APP_DATA.teams.filter(t => 
          t.team_name.toLowerCase().includes(query.toLowerCase())
        );
        renderFilteredTeams(filtered);
      }, 300);
    }
    
    function renderFilteredTeams(teams) {
      const container = $('#teamsList');
      if (!container) return;
      container.innerHTML = '';
      
      if (!teams.length) {
        container.innerHTML = '<p class="muted">No teams found.</p>';
        return;
      }
      
      teams.forEach(t => {
        const card = document.createElement('div');
        card.className = 'card mb-4';
        card.style.cursor = 'pointer';
        card.onclick = () => showTeamDetails(t.team_id);
        
        card.innerHTML = `
          <div style="display: flex; align-items: center; gap: 16px;">
            <img src="${t.logo || 'https://placehold.co/60x60'}" 
                 style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;" 
                 onerror="this.src='https://placehold.co/60x60'" />
            <div style="flex: 1;">
              <h4 style="margin: 0;">${t.team_name}</h4>
              <p class="muted" style="margin: 4px 0;">${t.sport_name} ‚Ä¢ ${t.event_name}</p>
              <p class="muted" style="margin: 4px 0;">Manager: ${t.manager_name}</p>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }
    
    // Match filters
function filterMatches() {
    const dateFrom = $('#matchDateFrom')?.value;
    const dateTo = $('#matchDateTo')?.value;
    const sportId = $('#matchSportFilter')?.value;
    
    let filtered = APP_DATA.matches;
    
    const filter = $('#matchViewFilter');
    if (filter && filter.value === 'my' && APP_DATA.myMatches) {
        filtered = APP_DATA.myMatches;
    }
    
    // Apply sport filter
    if (sportId) {
        filtered = filtered.filter(m => m.sport_id == sportId);
    }
    
    // Apply date filters
    if (dateFrom) {
        filtered = filtered.filter(m => new Date(m.match_date) >= new Date(dateFrom));
    }
    
    if (dateTo) {
        const endDate = new Date(dateTo);
        endDate.setHours(23, 59, 59, 999);
        filtered = filtered.filter(m => new Date(m.match_date) <= endDate);
    }
    
    renderFilteredMatches(filtered);
}

function clearMatchFilters() {
    $('#matchDateFrom').value = '';
    $('#matchDateTo').value = '';
    $('#matchSportFilter').value = '';
    renderMatches();
}
    
    function clearMatchFilters() {
      $('#matchDateFrom').value = '';
      $('#matchDateTo').value = '';
      renderMatches();
    }
    
    function renderFilteredMatches(matches) {
      // Temporarily store filtered matches
      const originalMatches = APP_DATA.matches;
      APP_DATA.matches = matches;
      renderMatches();
      APP_DATA.matches = originalMatches;
    }
  </script>
</body>
</html>